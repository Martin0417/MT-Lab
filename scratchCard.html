<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>scratch card by MT</title>
<style type="text/css">
#bg{
	position: relative;
	width:990px;
	margin:100px auto 0;
}
#pic{
	width:990px;
	height:600px;
	/*width:100%;
	height:100%;*/
	background:#fff url(./pie.png) no-repeat center;
	z-index:1;
}
#bg canvas{
	position:absolute;
	left:0;
	top:0;
	z-index:2;
	cursor:pointer;
}
</style>
</head>
<body>
	<div id="bg">
		<div id="pic"></div>
	</div>
</body>
<script type="text/javascript">
({
	init:function(){
		this.createCanvas();//初始化变量，创建canvas，获得ctx,
		this.decorateCanvas();//给canvas添加朦胧层
		this.radius = 20;//小圆半径
		this.color = "#000";//小圆填充颜色
		this.createPointCircle();//给ctx创建点击出现小圆的方法
		this.bindMousemove();//绑定鼠标移动的方法
		window.canvas = this.canvas;
		window.ctx = this.ctx;
	},
	createCanvas:function(){
		this.bg = document.getElementById('bg');
		this.canvas = document.createElement('canvas');
		this.ctx = this.canvas.getContext("2d");
		this.ctx.globalCompositeOperation = "destination-out";//【关键】目标图片与canvas的显示形式
		var w = bg.offsetWidth,h = bg.offsetHeight;
		this.canvas.width = w;//与目标图片同宽高
		this.canvas.height = h;
		this.bg.appendChild(this.canvas);
	},
	decorateCanvas:function(){
		this.ctx.fillSytle = "rgba(0,0,0,.5)";
		this.ctx.fill();
	},
	createPointCircle:function(){
		//点击出现小圆的方法
		this.ctx.createPointCircle = function(x,y,radius,fillColor){
			this.fillStyle = fillColor;
			this.beginPath();
			this.arc(x,y,radius,0,2*Math.PI);
			this.closePath();
			this.fill();
		}
	},
	bindMousemove:function(){
		var canvas = this.canvas,ctx = this.ctx,
			radius = this.radius,color = this.color;
		canvas.addEventListener("mousemove",function(e){
			var x = e.pageX - canvas.offsetLeft,
				y = e.pageY - canvas.offsetTop;
			ctx.createPointCircle(x,y,radius,color);
		});
			
	}

}).init();//启动初始化方法,暴走吧！！！
		
		
		
	
	// ctx.fillStyle = 'rgba(0,0,0,.5)';
	// ctx.
	// ctx.createCircle = function(x,y,radius,fillColor){
	// 	this.fillStyle=fillColor;
	// 	this.beginPath();
	// 	this.arc(x,y,radius,0,2*Math.PI);
	// 	this.closePath();
	// 	this.fill();
	// }
	// canvas.addEventListener('mousemove',function(e){
	// 	ctx.createCircle(e.layoutX,e.loyoutY,20,'#000');
	// });
	
</script>
</html>